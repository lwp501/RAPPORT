cd "C:\users\lwp501\research\RAPPORT\data\

capture log close
log using wave_7_cleaning_log, replace text

// program: wave_7_cleaning.do
// task: clean relevant wave 7 MCS datasets, and merge
// project: RAPPORT 
// author: Lewis Paton 
// code last updated: 10/02/2023

version 17
clear all
set linesize 80
macro drop _all


// want to define outcome variable, physical activity, and key confounders
// not avaialable in wave 6 

//outcome: kessler

// #1
// clean mcs7_cm_interview

use "source\UKDA-8682-stata_MCS_wave7\stata\stata13\mcs7_cm_interview.dta", clear 

gen CMrow = "_C1" if GCNUM00 == 1
replace CMrow = "_C2" if GCNUM00 == 2
replace CMrow = "_C3" if GCNUM00 == 3
gen PID = MCSID + "_" + string(GCNUM00) if (GCNUM00 > 0)
replace PID = MCSID + CMrow if (GCNUM00 > 0)

merge 1:1 PID using "derived\mcs6_included_PID.dta"

keep if _merge==3
drop _merge


// drop details about interview

drop GCINTCOMP 
drop GCWHYHLP0* 
drop GCWHOHLP00 

rename GCTRDE00 depression_treatment_current_w7
rename GCDAGE00 depression_age_w7
rename GCPHDE00 depression_last30_days_w7
rename GCDEAN00 depression_diagnosed_w7
rename GCTRDV00 depression_treatment_ever_w7

//yes or no (except age)
recode depression_treatment_current_w7 (2=0) (4=.) (5=.)
recode depression_age_w7 (-9=.) (-8=.) (-1=.) 
recode depression_last30_days_w7 (6=.) (7=.) (8=.) (5=0) (2=1) (3=1) (4=1) 
recode depression_diagnosed_w7 (2=0) (3=.) (4=.) (5=.)
recode depression_treatment_ever_w7 (4=.) (5=.)


//drop variables relating to consent
drop G_OUT_SAMPLE GCVERSION1 G_COMP_YPCAPI GCYPSKIPI GCYSKIPC GCYSKIPD GCYCON00


//place living 
drop GCTENR00 GCRENT00 GCPRMM00 GCPARY00 GCPRMY0A GCPRMY0B GCPRMY0C ///
GCPRMY0D GCPRMY0E GCPRMY0F GCPRMY0G GCPRMY0H GCPRMY0I GCPRMY0J GCPRMY0K ///
GCPRMY0L GCPRMY0M GCPRMY0N GCPRMY0O GCPRMY0P GCPRMY0Q GCHOMS00 GCHOMF00 ///
GCHOSS00 GCHOMP00 GCSTWH00 GCHOHW00 GCHOWK00 GCHOMT00 GCWHLI00 GCLINI00

//in care 
drop GCTICA00 GCCASC00

// education & work

drop GCEDUC00 GCEDUT00 GCAPNT00 GCTRIN00 GCTRNE00 GCTNPL00 GCTNLC00 ///
GCJOBS00 GCPRTM00 GCMNAC00 GCSEKR00 GCSKHR00 GCHMFM00 GCIFSE00 GCNOED00 ///
GCNEET00A GCNEET00B GCNEET00C GCNEET00D GCNEET00E GCNEET00F GCNEET00G ///
GCNEET00H GCNEET00I GCNEET10J GCNEET10K GCNEET10L GCNEET10M GCNEET10N ///
GCNEET10O GCNEET10P GCAPNY00 GCHURS00 GCEMPS00 GCEMPT00 GCSUPV00 GCEMPN00 ///
GCSEEM00 GCSHFT00 GCZERO00 GCPERM0A GCPERM0B GCPERM0C GCPERM0D GCPERM0E ///
GCPERM0F GCPERM0G GCPERM0H GCPERM0I GCPERM0J GCPERM0K GCIFPD00 GCIFWG00 ///
GCIFTA00 GCIFSM00 GCPYPD00 GCGPYP00 GCOCIN00 GCRCSP00 GCRCSF00 GCRSBE00 ///
GCBURS00 GCRGTS00 GCINNV00 GCOSRC00

//health 
drop GCCGHE00 GCCLSI00 GCCLSM0A GCCLSM0B GCCLSM0C GCCLSM0D GCCLSM0E GCCLSM0F ///
GCCLSM0G GCCLSM0H GCCLSM0I GCCLSM0J GCCLSM0K GCCLSM0L GCCLSM0M GCCLSM0N ///
GCCLSM0O GCCLSM0P GCCLSM0Q GCCLSM0R GCCLSM0S GCCLSM0T GCCLSL00 GCCLSP00 ///
GCACCA00 GCADMA00

rename GCPHEX00 physical_activity_days_w7
recode physical_activity_days_w7 (7=.) (8=.)

// as per government guidelines 
// https://www.nhs.uk/live-well/exercise/exercise-guidelines/physical-activity-guidelines-children-and-young-people/

gen physical_activity_guideline_w7 = .
replace physical_activity_guideline_w7 = 1 if physical_activity_days_w7 == 1 | ///
physical_activity_days_w7 ==2
replace physical_activity_guideline_w7 = 0 if physical_activity_days_w7 == 3 | ///
physical_activity_days_w7 == 4 | physical_activity_days_w7 ==5

//language 
drop GCLANW00 GCWESM00 GCYPWLSH00

//consent variables 
drop GCYPCALLB GCINFOEND2 GCINFOEND30A GCINFOEND30B GCINFOEND30C GCINFOEND30D ///
GCINFOEND30E GCINFOEND30F GCINFOEND30G GCINFOEND30H GCINFOEND30I GCINFOEND30J ///
GCINFOEND30K GCVERSION2 G_COMP_YPCASI


//family relationsiphs 
rename GCTAIM00 freq_talk_to_TAIM_w7

rename GCPHMA00 communicate_mother_digital_w7
rename GCPHPA00 communicate_father_digital_w7

//drop other communication variables
drop GCCOMO00 GCSEMA00 GCCOFA00 GCSEFA00 GCRLQM00 GCRLQF00 

// personal views of self 

drop GCSDQA00 GCSDQB00 GCSDQC00 GCSDQD00 GCSDQE00 GCSDQF00 GCSDQG00 GCSDQH00 ///
GCSDQI00 GCSDQJ00 GCSDQK00 GCSDQL00 GCSDQM00 GCSDQN00 GCSDQO00 GCSDQP00 ///
GCSDQQ00 GCSDQR00 GCSDQS00 GCSDQT00 GCSDQU00 GCSDQV00 GCSDQW00 GCSDQX00 ///
GCSDQY00 GCBIGA00 GCBIGB00 GCBIGC00 GCBIGD00  GCBIGE00 GCBIGF00 GCBIGG00 ///
GCBIGH00 GCBIGI00 GCBIGJ00 GCBIGK00 GCBIGL00 GCBIGM00 GCBIGO00 GCBIGN00


//mental health type questions
drop GCPHHO00 GCPHRF00 GCPHEE00 GCPHWO00 GCPHNE00 GCWWOP00 GCWWUS00 GCWWRE00 ///
GCWWDE00 GCWWTH00 GCWWCL00 GCWWMN00 GCSATI00 GCGDQL00 GCDOWL00 GCVALU00 GCGDSF00
 
// self-harm
drop GCSHCU00 GCSHBU00 GCSHBR00 GCSHOD00 GCSHPU00 GCSHRM00 GCSHRZ0A GCSHRZ0B ///
GCSHRZ0C GCSHRZ0D GCSHRZ0E GCSHRZ0F GCSHRZ0N GCSHRZ0O GCSHRZ0P GCSHRZ0Q ///
GCSHRZ0R GCSUIC00

//sexual relationships
drop GCBGFR00 GCSXEV00 GCSXAG00 GCCOND00 GCPILL00 GCIMPL00 GCINJC00 GCEMCO00 ///
GCOTCO00 GCSFEV00 GCSTIE00 GCSTEV00 GCPGMK00 GCPREG00 GCPRGR0A GCPRGR0B ///
GCPRGR0C GCPRGR0D GCPRGR0E GCPRGR0F GCPRGR0G GCPRGR0H GCPRGR0I GCPRGR0J ///
GCPRGR0K GCPRGR0L GCPRGR0M GCPRGR0N GCPRGR0O GCPRGR0P GCPRGR0Q GCPRGR0R ///
GCPRGR0S GCPRGR0T GCPGOC0A GCPGOC0B GCPGOC0C GCPGOC0D GCPGOC0E GCPGOC0F ///
GCPGOC0G GCPGOC0H GCPGOC0I GCPGOC0J GCPGOC0K GCPGOC0L GCPGOC0M GCPGOC0N ///
GCPGOC0O GCPGOC0P GCPGOC0Q GCPGOC0R GCPGOC0S GCPGOC0T GCPGOE0A GCPGOE0B ///
GCPGOE0C GCPGOE0D GCPGOE0E GCPGOE0F GCPGOE0G GCPGOE0H GCPGOE0I GCPGOE0J ///
GCPGOE0K GCPGOE0L GCPGOE0M GCPGOE0N GCPGOE0O GCPGOE0P GCPGOE0Q GCPGOE0R ///
GCPGOE0S GCPGOE0T GCPGOY0A GCPGOY0B GCPGOY0C GCPGOY0D GCPGOY0E GCPGOY0F ///
GCPGOY0G GCPGOY0H GCPGOY0I GCPGOY0J GCPGOY0K GCPGOY0L GCPGOY0M GCPGOY0N ///
GCPGOY0O GCPGOY0P GCPGOY0Q GCPGOY0R GCPGOY0S GCPGOY0T GCPGOM0A GCPGOM0B ///
GCPGOM0C GCPGOM0D GCPGOM0E GCPGOM0F GCPGOM0G GCPGOM0H GCPGOM0I GCPGOM0J ///
GCPGOM0K GCPGOM0L GCPGOM0M GCPGOM0N GCPGOM0O GCPGOM0P GCPGOM0Q GCPGOM0R ///
GCPGOM0S GCPGOM0T GCPUMN00 GCAGMN00

//risky behaviours 
drop GCSMOK00 GCAGSM00 GCVAPE00 GCALCD00 GCALAG00 GCALCN00 GCALNF00 ///
GCALFV00 GCAGFV00 GCALFN00 GCDRUA00 GCDRUB00 GCDRUC00 GCDRUD00 GCDRUL00 ///
GCDRUS00 GCDRUI00 GCDRUJ00 GCDRUK00 GCDRAN00 GCDRBN00 GCDRCN00 GCDRDN00 ///
GCDRGN00 GCDRSN00 GCDRIN00 GCDRJN00 GCDRKN00

//bullying 
drop GCVICG00 GCVICB00 GCVICA00 GCVICC00 GCVICE00 GCVICH00 GCVICP00 GCVICF00 GCVICS00

//not sure what these are
drop GCVIRA00 GCVISE00 GCVISO00 GCVIAG00 GCVIDI00 GCVIAP00

//crime
drop GCSTOL00 GCSPRY00 GCDAMG00 GCROBH00 GCJYRD00 GCFIRE00 GCCRED00 GCHACK00 ///
GCVIRS00 GCSTON00 GCSPRN00 GCDAMN00 GCROBN00 GCJYRN00 GCFIRN00 GCCRDN00 ///
GCHAKN00 GCVIRN00 GCFRWT00 GCHITT00 GCWEPN00 GCSTLN00 GCHRSD00 GCRMRS00 GCSEXA00 ///
GCGANG00 GCPOLS00 GCCAUT00 GCARES00 GCCORT00 GCKNIF00

//sexual orientation & gender identity 
rename GCSXID00 sexuality_w7 
rename GCGNID00 gender_id_w7 
drop GCSXAT00


gen lgbtq_w7 = .
replace lgbtq_w7 = 1 if sexuality_w7 >=3 & sexuality_w7 <=6
replace lgbtq_w7 = 0 if sexuality_w7 == 1 | sexuality_w7==2

drop sexuality_w7

//consent 
drop GCOEIT100 GCOEIT20A GCOEIT20B GCOEIT20C GCOEIT20D GCOEIT20E GCOEIT20F ///
GCOEIT20G GCOEIT20H GCOEIT20I G_COMP_YPCAWI G_COMP_YPCAWI_PLACEMENT ///
GCYCWELSH00 GCYPLOGINW GCYCREMINDER0A GCYCREMINDER0B GCYCREMINDER0C ///
GCYCREF0A GCYCREF0B GCYCREF0C GCYCREF0D GCYCREF0E GCYCREF0F GCYCREF0G ///
GCYCREF0H GCYCREF0I GCYCREF0J GCYCREF0K GCYCREF0L GCYCREF0M GCYCREF0N ///
GCYCREF0O GCYCREF0P GCYCREF0Q GCYCREF0R GCYCREF0S GCYCREF0T GCYCREF0U ///
GCYCREF0V GCYCREF0W GCYCREF0X GCYCREF0Y GCYCREF0Z

//relating to questionnaire
drop GCYPCAWIFB1000 GCYPCAWIFB1100 GCYPCAWIFB1200 GCYPCAWIFB1300 ///
GCYPCAWIFB1400 GCYPCAWIWELSH00

//personal opinions 
drop GCBSCA00 GCBSCB00 GCBSCC00 GCBSCD00


// social attitudes 
drop GCOPPO00 GCOPJO00 GCOPCH00 GCOPAB00 GCOPRA00 GCOPRE00 GCOPEN00

//activities 
rename GCTHEA00 activity_theatre_w7 
rename GCMGIG00 activity_live_music_w7 
rename GCLIBR00 activity_library_w7 
rename GCMUSM00 activity_museum_w7 
rename GCRJOY00 activity_read_w7
rename GCBAND00 activity_music_w7
rename GCSPOR00 activity_watch_sport_w7
rename GCORGA00 activity_youth_club_w7
rename GCRLSV00 activity_religious_w7
rename GCSPFD00 acitivity_friends_outside_w7


drop GCDISC00 GCVOLW00 GCPOLM00 GCTVHO00 GCCOMH00 ///
GCSOME00 GCSOCM00 GCSOCH00 GCGAMA00 GCGMBL00 GCGAEM00 GCGAMJ00

//weight 
rename GCWEGT00 perception_of_weight_w7 
rename GCEXWT00 exercised_weight_w7 
rename GCETLS00 food_weight_w7 
rename GCLSWT00 changes_weight_w7

//food
drop GCBRKN00 GCFRUT00 GCVEGI00 GCBRED00 GCMILK00 GCASWD00 GCSWTD00 GCTKWY00

//attitudes to risk and money
drop GCRSKA00 GCRSKB00 GCRSKC00 GCRSKD00 GCRSKE00 GCRSKF00 GCRSKG00 ///
GCRSKH00 GCRSKI00 GCRSKJ00 GCPRFA00 GCPRFB00 GCPRFC00 GCPRFD00 GCPRFE00 ///
GCPRFF00 GCPRFG00 GCPRFH00 GCPRFI00 GCPRFJ00

//languages 
drop GCLANF0A GCLANF0B GCLANF0C GCLANF0D GCLANF0E GCLANF0F GCLANF0G GCLANF0H ///
GCLANF0I GCLANF0K GCLANF0L GCLANF0O GCLANF0P GCLANF0Q GCLANF0R GCLANF0S ///
GCLANF0U GCLANF0V GCLANF0W GCHLAN0A GCHLAN0B GCHLAN0C GCHLAN0D GCHLAN0E ///
GCHLAN0F GCHLAN0G GCHLAN0H GCHLAN0I GCHLAN0K GCHLAN0L GCHLAN0O GCHLAN0P ///
GCHLAN0Q GCHLAN0R GCHLAN0S GCHLAN0U GCHLAN0V GCHLAN0W

//uni
drop GCUNIQ00 GCSTYR00 GCREUN00 GCSTUN00 GCCOST00 GCCNFA00

//not sure
drop GCQZPY00 GCQZLN00 GCPDJA00 GCPDJB00 GCEARN00 GCERNU00 ///
GCASPR0A GCASPR0B GCASPR0C GCASPR0D GCASPR0E GCASPR0F GCASPR0G GCASPR0H GCASPR0I


rename GCSQLT00 sleep_quality_w7

gen sleep_good_w7 = .
replace sleep_good_w7=1 if sleep_quality_w7==1 | sleep_quality_w7==2
replace sleep_good_w7=0 if sleep_quality_w7==3 | sleep_quality_w7==4

label variable sleep_good_w7 "slef-rated sleep quality overall, good='very good' or 'fairly good'"

drop sleep_quality_w7


//relationship and care 
drop  GCLWPA00 GCOUTW00 GCOTNT00 GCCARE00 ///
GCCRWO0A GCCRWO0B GCCRWO0C GCCRWO0D GCCRWO0E GCCRWO0F GCCRWO0G GCCRWO0H ///
GCCRWO0I GCCRWO0J GCCRWO0K GCCRWO0L GCCRWO0M GCCRWO0N GCCRWO0O GCCRWO0P ///
GCCRWO0Q GCCRWO0R GCCRHR00 GCSAFF00 GCTRSS00  GCNCLS00

//travel
drop GCTRSC00 GCCYCF00 GCTRTI00

//boost sample - predominantly who live with
drop GCCOAG00 GCCAWIWELSH GCHHLV0A GCHHLV0B GCHHLV0C GCHHLV0D GCHHLV0E GCVERSION7

//education
drop GCCMCT00 GCSTUD00 GCDIFY00 GCSCTY00 GCSAMS00 GCSASC00 GCCSWH0A GCCSWH0B ///
GCCSWH0C GCCSWH0D GCCSWH0E GCCSWH0F GCCSWH0G GCCSWH0H GCCSWH0I GCCSWH0J ///
GCCSWH0K GCCSWH0L GCCSWH0M GCCSWH0N GCCSWH0O GCCSWH0P GCCSWH0Q GCCSWH0R ///
GCCSWH0S GCCSWH0T GCCSWH0U GCCSWH0V GCCSWH0W GCCSWH0X GCCSWH0Y GCCSWH0Z ///
GCSOTH00 GCNOTH00 GCCAPL00 GCOPGC0A GCOPGC0B GCOPGC0C GCOPGC0D GCOPGC0E ///
GCOPGC0F GCOPGC0G GCOPGC0H GCOPGC0I GCOPGC0J GCOPGC0K GCOPGC0L GCOPGC0M ///
GCOPGC0N GCOPGC0O GCOPGC0P GCOPGC0Q GCOPGC0R GCOPGC0S GCOPGC0T

//fag/consent physical measurements
drop G_COMP GCCHAC0A GCCHAC0B GCCHAC0C GCCHAC0D GCCHAC0E

rename GCHTCM00 height_w7
recode height_w7 (-5=.) (-1=.)

//drop other height variables 
drop GCHTFT00 GCHTIN00 GCUNHT00 GCHTCMCHK10A GCHTCMCHK10B GCHTCMCHK10C ///
GCHTCMCHK10D GCHTM100 GCHTM200 GCHTRL0A GCHTRL0B GCHTRL0C GCHTRL0D GCHTRL0E ///
GCHTRL0F GCHTRL0G GCHTRL0H GCHTRL0I GCHTRL0J GCHTRL0K GCHTRL0L GCHTRL0M GCHTRL0N


rename GCWTCM00 weight_w7 
recode weight_w7 (-5=.) (-1=.)

//drop other weight variables
drop GCWTST00 GCWTPO00 GCBFPCD00 GCFEET00 GCWTSC00 GCWTRL0A GCWTRL0B GCWTRL0C ///
GCWTRL0D GCWTRL0E GCWTRL0F GCWTRL0G GCWTRL0H GCWTRL0I GCWTRL0J GCPMRC0A ///
GCPMRC0B GCPMRC0C GCPMRC0D GCPMWLSH WELSHCASI WELSHCASI2 GCCAWIH00

rename GCBFPC00 body_fat_percent_w7
recode body_fat_percent_w7 (-5=.) (-1=.)

// salary questions - most don't work, of those who do, salary's predominantly in the same banding - no info

drop GCFXRA00 GCPAY100 GCGPAY00  GCSJUA00 GCRCPN00 GCRCFN00 GCRSBN00 ///
GCRGTN00 GCINNN00 GCBRSN00 GCOSRN00

///aspriations
drop GCCARRSOC01_TR3 GCCARRSOC02_TR3 GCCARRSOC03_TR3 GCCARRSOC04_TR3 ///
GCCARRSOC05_TR3 GCCARRSOC06_TR3

//religion

gen religion_w7 = .

replace religion_w7 = 1 if GCRELE00_R20 == 2 | GCRELW00_R20 == 2 | GCRELS00_R20 == 2  | ///
GCRELS00_R20 == 3 | GCRELS00_R20 == 4 | GCRELN00_R20 == 1 | ///
GCRELN00_R20 == 2 | GCRELN00_R20 == 3

replace religion_w7 = 0 if  GCRELE00_R20==1 | GCRELW00_R20 == 1 | ///
GCRELS00_R20== 1  | GCRELN00_R20 == 6 

replace religion_w7 = 2 if GCRELE00_R20 == 4

replace religion_w7 = 3 if GCRELE00_R20 == 7

replace religion_w7 = 4 if GCRELE00_R20 == 6

label define religionlabs 0 "None" 1 "Christian" 2 "Hindu" 3 "Sikh" 4 "Muslim" 

label values religion_w7 religionlabs

drop GCRELE00_R20 GCRELW00_R20 GCRELS00_R20 GCRELN00_R20

//misc variables
drop GCSOC00_TR3 GCSIC00_TR2 GCIWRIDANON GDSCH1ANON GDSCH2ANON

save "derived\mcs7_cm_interview_clean.dta", replace


// #2
// clean mcs7_cm_derived

use "source\UKDA-8682-stata_MCS_wave7\stata\stata13\mcs7_cm_derived.dta", clear 

gen CMrow = "_C1" if GCNUM00 == 1
replace CMrow = "_C2" if GCNUM00 == 2
replace CMrow = "_C3" if GCNUM00 == 3
gen PID = MCSID + "_" + string(GCNUM00) if (GCNUM00 > 0)
replace PID = MCSID + CMrow if (GCNUM00 > 0)

merge 1:1 PID using "derived\mcs6_included_PID.dta"

keep if _merge==3
drop _merge

rename GCBMIN7 bmi_w7

rename GEMOTION_C sdq_emotional_self_w7 
rename GCONDUCT_C sdq_conduct_self_w7 
rename GHYPER_C sdq_hyper_self_w7 
rename GPEER_C sdq_peer_self_w7 
rename GPROSOC_C sdq_prosoc_self_w7 
rename GEBDTOT_C sdq_totdiff_self_w7

rename GEMOTION sdq_emotional_parent_w7 
rename GCONDUCT sdq_conduct_parent_w7 
rename GHYPER sdq_hyper_parent_w7 
rename GPEER sdq_peer_parent_w7 
rename GPROSOC sdq_prosoc_parent_w7 
rename GEBDTOT sdq_totdiff_parent_w7

rename GDCKESSL kessler_w7

recode kessler_w7 (-1=.)



rename GDCOPEN ocean_open_w7 
rename GDCCONSC ocean_consc_w7 
rename GDCEXTRAV ocean_extrav_w7 
rename GDCAGREE ocean_agree_w7 
rename GDCNEUROT ocean_neurot_w7

foreach j in open consc extrav agree neurot {
	replace ocean_`j'_w7=. if ocean_`j'_w7 < 0
}

drop GCMCS7AG GCOVWGT7 GCOBESE7 GCUNDWU7 GCOVWTU7 GCOBESU7

// raw mental wellbeing scores transformed to metric scale + restraint scores' 
drop GDWEMWBS GDRESTR

// obesity 
drop GCOBFLG7 GCUK90O7

save "derived\mcs7_cm_derived_clean.dta", replace


log close
exit